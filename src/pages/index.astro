---
import Layout from '../layouts/Layout.astro';

const schedule = [
	{ time: '09:00 - 10:00', name: 'Opening Ceremony' },
	{ time: '10:30', name: 'Keynote: VidLove' }
];

const now = new Date();

function parseToday(timeStr) {
	const [hh, mm] = timeStr.split(':').map(Number);
	return new Date(now.getFullYear(), now.getMonth(), now.getDate(), hh, mm);
}

function eventState(ev) {
	const start = parseToday(ev.time);
	const end = new Date(start.getTime() + 60 * 60 * 1000); // 60 min duration
	if (now >= start && now < end) return 'current';
	if (now >= end) return 'passed';
	return 'upcoming';
}
---

<Layout>
	<main class="site">
		<!-- Section 1: Hero -->
		<section class="panel hero" id="home">
			<div class="container">
				<h1 class="title">VidLoveVidU2026</h1>
				<div class="image placeholder" aria-hidden="true">Image placeholder</div>
				<a class="btn" href="#registration">Register Now</a>
			</div>
		</section>

		<!-- Section 2: Map / Floorplan -->
		<section class="panel map" id="map">
			<div class="container">
				<h2>แผนผังงาน (Map)</h2>
				<div class="image large placeholder" aria-hidden="true">Map placeholder — add image here</div>
			</div>
		</section>

		<!-- Section 3: Schedule -->
		<section class="panel schedule" id="schedule">
			<div class="container">
				<h2>Schedule</h2>
				<div class="table-wrap">
					<table>
						<thead>
							<tr><th>Time</th><th>Event</th></tr>
						</thead>
						<tbody>
							{schedule.map(ev => {
								const state = eventState(ev);
								return (
									<tr class={state}>
										<td>{ev.time}</td>
										<td>{ev.name}</td>
									</tr>
								);
							})}
						</tbody>
					</table>
				</div>
			</div>
		</section>

		<!-- Section 4: Sponsors -->
		<section class="panel sponsors" id="sponsors">
			<div class="container">
				<h2>Sponsors</h2>
				<div class="sponsor-grid">
					<div class="sponsor placeholder">Sponsor image</div>
					<div class="sponsor placeholder">Sponsor image</div>
				</div>
			</div>
		</section>
	</main>

	<!-- Sticky bottom nav -->
	<nav class="bottom-nav" role="navigation" aria-label="Primary">
		<button data-target="#home" title="Home">
			<svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path fill="currentColor" d="M12 3l9 8h-3v8h-12v-8h-3z"></path></svg>
			<span>Home</span>
		</button>
		<button data-target="#registration" title="Registration">
			<svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path fill="currentColor" d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0 2c-4.418 0-8 1.79-8 4v2h16v-2c0-2.21-3.582-4-8-4z"/></svg>
			<span>Registration</span>
		</button>
		<button data-target="#games" title="Games">
			<svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path fill="currentColor" d="M12 2l2 4h4l-3 3 1 4-4-2-4 2 1-4-3-3h4z"/></svg>
			<span>Games</span>
		</button>
	</nav>

	<!-- Registration anchor (target for button) -->
	<div id="registration" class="hidden-anchor">Registration section (link target)</div>
</Layout>

<style>
	:root{--bg:#0f1724;--panel:#0b1220;--accent:#ff6b6b;--muted:#7b8693}
	/* Hide native scrollbar and prevent default page scrolling; we'll control navigation via script */
	html,body{height:100%;overflow:hidden}
	.site{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0}
	.panel{min-height:100vh;display:flex;align-items:center;justify-content:center;color:#eef2f7;padding:2rem}
	.hero{background:linear-gradient(180deg,#0b1220, #071025);text-align:center}
	.map{background:linear-gradient(180deg,#071025,#0b1220)}
	.schedule{background:#071428}
	.sponsors{background:#08131f}
	.container{width:100%;max-width:1000px}
	.title{font-size:clamp(2rem,6vw,4rem);margin:0 0 1rem}
	.image.placeholder{width:100%;height:220px;background:linear-gradient(90deg,#092032,#113049);display:flex;align-items:center;justify-content:center;color:var(--muted);border-radius:8px}
	.image.large{height:60vh}
	.btn{display:inline-block;margin-top:1rem;padding:.75rem 1.2rem;background:var(--accent);color:#fff;border-radius:8px;text-decoration:none}

	/* Table */
	.table-wrap{overflow:auto;margin-top:1rem}
	table{width:100%;border-collapse:collapse;background:rgba(255,255,255,0.03);border-radius:8px;overflow:hidden}
	th,td{padding:.9rem 1rem;text-align:left}
	tbody tr.upcoming{color:#e6eef8}
	tbody tr.current{background:linear-gradient(90deg,rgba(255,107,107,0.12),rgba(255,107,107,0.04));color:#fff;font-weight:600}
	tbody tr.passed{color:var(--muted);opacity:.6}

	.sponsor-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1rem;margin-top:1rem}
	.sponsor.placeholder{height:100px;background:linear-gradient(90deg,#0a2230,#123147);display:flex;align-items:center;justify-content:center;border-radius:8px;color:var(--muted)}

	/* Bottom nav */
	.bottom-nav{position:fixed;left:0;right:0;bottom:12px;margin:0 auto;max-width:800px;background:rgba(7,12,18,0.8);backdrop-filter:blur(6px);display:flex;gap:8px;padding:8px;border-radius:12px;justify-content:space-around}
	.bottom-nav button{background:transparent;border:0;color:#dbe7f5;display:flex;flex-direction:column;align-items:center;gap:4px;padding:6px 10px;border-radius:8px}
	.bottom-nav button:hover{background:rgba(255,255,255,0.03)}
	.bottom-nav svg{display:block}

	.hidden-anchor{position:relative;top:-60px}

	@media(min-width:700px){.container{padding:0 1rem}}
</style>

<script type="module">
	// Full-page scroll behavior: wheel & touch -> navigate between .panel sections
	const panels = Array.from(document.querySelectorAll('.panel'));
	if (panels.length === 0) {
		// nothing to do
	} else {
		let idx = 0;
		let isScrolling = false;
		const scrollDuration = 500; // ms

		function goTo(i) {
			if (i < 0 || i >= panels.length) return;
			isScrolling = true;
			panels[i].scrollIntoView({ behavior: 'smooth' });
			setTimeout(() => { isScrolling = false; idx = i; }, scrollDuration);
		}

		// Wheel handling
		let wheelTimeout;
		window.addEventListener('wheel', (e) => {
			if (isScrolling) return;
			clearTimeout(wheelTimeout);
			wheelTimeout = setTimeout(() => {}, 50);
			const delta = e.deltaY;
			if (Math.abs(delta) < 10) return;
			if (delta > 0) goTo(Math.min(idx + 1, panels.length - 1));
			else goTo(Math.max(idx - 1, 0));
		}, { passive: true });

		// Touch handling
		let touchStartY = null;
		window.addEventListener('touchstart', (e) => {
			touchStartY = e.touches ? e.touches[0].clientY : null;
		}, { passive: true });
		window.addEventListener('touchend', (e) => {
			if (touchStartY == null) return;
			const touchEndY = e.changedTouches ? e.changedTouches[0].clientY : null;
			if (touchEndY == null) return;
			const diff = touchStartY - touchEndY;
			if (Math.abs(diff) < 40) return;
			if (diff > 0) goTo(Math.min(idx + 1, panels.length - 1));
			else goTo(Math.max(idx - 1, 0));
			touchStartY = null;
		}, { passive: true });

		// Buttons in bottom nav
		document.querySelectorAll('.bottom-nav button[data-target]').forEach(btn => {
			btn.addEventListener('click', () => {
				const target = btn.dataset.target;
				const el = document.querySelector(target);
				if (el) {
					const i = panels.indexOf(el);
					if (i >= 0) goTo(i);
				}
			});
		});

		// Support hash navigation (if user sets location.hash)
		function hashToIndex() {
			const id = location.hash ? location.hash.replace('#','') : null;
			if (!id) return;
			const el = document.getElementById(id);
			if (!el) return;
			const i = panels.indexOf(el);
			if (i >= 0) goTo(i);
		}
		window.addEventListener('hashchange', hashToIndex);

		// Initialize: ensure first panel in view
		panels[0].scrollIntoView();
	}
</script>
